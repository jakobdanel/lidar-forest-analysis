### Canopy Height Model

```{r}
#| warning: false
#| results: hide
#| code-fold: true
chms <- lfa::lfa_visit_all_areas(lfa::lfa_chm)
```

In the upcoming section, we will delve into the examination of canopy heights within various patches. In order to acquire valuable insights, we extracted canopy height data from the point cloud, utilizing a resolution of $0.5\times0.5$m. Our subsequent analysis involved an exploration of the distribution patterns inherent in the canopy heights dataset.

```{r}
#| warning: false
#| results: hide
#| code-fold: true
patches <- lfa::lfa_get_all_areas()
patches$chm_mean = NA
patches$chm_var = NA
patches$chm_median = NA
for (area_key in names(chms)) {
  area <- chms[area_key]
  area[[area_key]] |> as.vector() -> vec
  patches[patches$area == area_key, "chm_mean"] <-
    mean(vec, na.rm = T)
  patches[patches$area == area_key, "chm_var"] <-
    var(vec, na.rm = T)
  patches[patches$area == area_key, "chm_median"] <-
    median(vec, na.rm = T)
  
}
```

To initiate our examination, we will focus on the means within these distributions. Notably, pine exhibits relatively low mean values, indicating a consistent trend within this species. Conversely, the mean values for spruce are evenly distributed across the entire range of means, suggesting a broader variability within this species. In contrast, oak demonstrates relatively high mean values, indicative of a distinct pattern within the oak canopy heights. Moving on to beech, the mean values are moderate on average, with the exception of one outlier in Billerbeck, which boasts the highest mean canopy height among all patches. Interestingly, despite the absence of complete clustering based on dominant species, discernible trends emerge from the analysis. Overall, our exploration of means provides valuable insights into the varied patterns and trends present in canopy heights across different tree species.

```{r}
#| code-fold: true
#| warning: false
#| fig-cap: Mean Canopy Height across all patches colored by the dominant specie of each patch.
#| label: fig-chm-mean
lfa::lfa_create_grouped_bar_plot(patches,"specie","chm_mean","area",ylab = "Mean", title = "Mean Canopy Height")
```

Shifting our focus to variances, our analysis reveals distinct patterns among different tree species. Beech canopy height exhibits notably high variances across various patches, with the exception of Bielefeld Brackwede. Similarly, spruce displays relatively high variances consistently across all patches. On the other hand, oak demonstrates moderate variances overall, but with one extreme outlier characterized by low variance in Rinkreode. In contrast, pine showcases relatively low variances across its patches.

It is noteworthy that while some clustering effects are observed, the data for beech and oak appears to be somewhat noisy. Interestingly, a trend emerges, indicating that conifers, such as spruce and pine, exhibit more pronounced clustering effects compared to deciduous trees. This variance analysis contributes to a deeper understanding of the diverse patterns and noise levels associated with canopy height data for different tree species.

```{r}
#| code-fold: true
#| warning: false
#| fig-cap: Variance Canopy Height across all patches colored by the dominant specie of each patch.
#| label: fig-chm-var
lfa::lfa_create_grouped_bar_plot(patches,"specie","chm_var","area",ylab = "Variance", title = "Variance of Canopy Height")
```

In the current examination, our focus turns to medians, offering additional insights into the central tendencies of canopy heights for various tree species. Beech exhibits high median values, accentuated by the presence of one outlier, namely Bielefeld Brackwede. Oak, on the other hand, displays median values ranging from moderate to relatively high, showcasing a consistent trend within this species. Contrastingly, pine reveals low median values, indicating a clustered distribution pattern. In the case of spruce, median values are spread out and unclustered, providing a distinctive characteristic for this coniferous species. The medians serve as valuable metrics, particularly for understanding the central tendencies within deciduous trees, as indicated by the noteworthy patterns observed in beech and oak.

```{r}
#| code-fold: true
#| warning: false
#| fig-cap: Median Canopy Height across all patches colored by the dominant specie of each patch.
#| label: fig-chm-median
lfa::lfa_create_grouped_bar_plot(patches,"specie","chm_median","area",ylab = "Median", title = "Median Canopy Height")
```

Diverse clustering effects emerge when considering different statistical measures, providing a preliminary overview of the canopy height distributions for various tree species. These statistics, including means, variances, and medians, offer a valuable initial perspective on the distribution patterns. However, a more in-depth examination of the distributions is imperative to gain a comprehensive overview and delve deeper into the nuances of the canopy height data for each tree species. This multi-statistical approach serves as an effective starting point for understanding the overarching patterns while emphasizing the necessity of further exploration to uncover the intricacies within the distributions.

```{r}
#| code-fold: true
#| warning: false
#| results: hide
patches <- sf::st_read("./research_areas.shp")
result_df = NULL
for(patch in chms |> names()){
  species <- patches[patches$name == patch,]$species
  df <- chms[[patch]] |> as.data.frame()
  df$specie <- species
  df$area <- patch
  if(is.null(result_df)){
    result_df <- df
  } else {
    result_df <- dplyr::bind_rows(result_df,df)
  }
}
```

The scrutiny of density plots offers a nuanced exploration of the canopy height distributions for different tree species. For beech, the presence of one outlier, as next identified in the boxplot analysis, is evident. However, the overall shapes of the density curves for beech patches are notably similar. In the case of oak, the density curves exhibit similar shapes, with the peak of the Hamm patch appearing slightly lower compared to others, introducing a subtle variation within the species. Pine displays remarkably similar shapes across its density curves, characterized by higher peaks when compared to other species, suggesting a consistent and distinctive pattern within the pine patches. Turning to spruce, one outlier is identified, while the remaining density curves share similar shapes. Notably, the highest peaks in spruce patches are concentrated around zero values, indicative of a specific distribution characteristic within this coniferous species. The density plot analysis contributes to a more nuanced understanding of the distribution shapes and outlier presence within each tree species, enhancing the overall comprehension of canopy height variations across different patches.

```{r}
#| warning: false
#| code-fold: true
#| fig-cap: Density plots for the distribution of canopy heights (resolution $0.5\times0.5$m) across all patches grouped by dominant species
lfa::lfa_create_density_plots(result_df,"Z", xlims = c(0,40), title = "Density Plots for Canopy Height Distributions")
```

The examination of boxplots provides a more detailed perspective on the distribution characteristics of canopy heights for different tree species. In the case of beech, the boxes reveal limited shared domains, with one box significantly larger than the others, indicating a distinctive distribution pattern. For oak, numerous shared box connections are observed, accompanied by a prevalence of outliers in the lower domain, contributing to the complexity of the distribution. Pine exhibits notably similar medians, with boxes of comparable sizes, showcasing a clustered distribution pattern. Conversely, in the case of spruce, two boxplots display remarkable similarity in terms of box position, median, and antennas, while one box stands out significantly lower, suggesting a unique distribution pattern.

The boxplot analysis proves useful in capturing distribution details, highlighting both clustering effects and outliers. Notably, oak and pine present relatively clustered patterns, while beech and spruce show more variability, the latter with the presence of one outlier. This nuanced examination enhances our understanding of the canopy height distributions within each tree species.

```{r}
#| warning: false
#| code-fold: true
#| fig-cap: Boxplots for the distribution of canopy heights (resolution $0.5\times0.5$m) across all patches grouped by dominant species
lfa::lfa_create_boxplot(result_df,"Z","area","specie", title = "Boxplots for Canopy Height Distributions")
```

In summary, the exploration of canopy height proves to be a valuable endeavor, unveiling discernible patterns and differences among various tree species. Noteworthy clustering effects are evident, providing insights into the distinct characteristics of each species. However, it is important to acknowledge the presence of high variance within species, indicating considerable variability even within the same tree type. This underscores the complexity of canopy height distributions and emphasizes the need for a comprehensive and detailed analysis to capture the nuances inherent in the data. Overall, while overarching trends and differences are observable, the intricacies within each species' canopy height distribution call for a thorough investigation to fully comprehend the extent of variability.

